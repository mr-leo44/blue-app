'use strict';
class Webcam{ constructor(e,t,s,i){this._webcamElement=e,this._webcamElement.width=this._webcamElement.width||640,this._webcamElement.height=this._webcamElement.height||.75*this._webcamElement.width,this._facingMode=t,this._webcamList=[],this._streamList=[],this._selectedDeviceId="",this._canvasElement=s,this._snapSoundElement=i}function facingMode(){return this._facingMode}function facingMode(e){this._facingMode=e}function webcamList(){return this._webcamList}function webcamCount(){return this._webcamList.length}function selectedDeviceId(){return this._selectedDeviceId}getVideoInputs(e){return this._webcamList=[],e.forEach(function(e){"videoinput"===e.kind&&this._webcamList.push(e)}),1==this._webcamList.length&&(this._facingMode="user"),this._webcamList}getMediaConstraints(){var e={};return""==this._selectedDeviceId?e.facingMode=this._facingMode:e.deviceId={exact:this._selectedDeviceId},{video:e,audio:!1}}selectCamera(){for(let e of this._webcamList)if("user"==this._facingMode&&e.label.toLowerCase().includes("front")||"enviroment"==this._facingMode&&e.label.toLowerCase().includes("back")){this._selectedDeviceId=e.deviceId;break}}flip(){this._facingMode="user"==this._facingMode?"enviroment":"user",this._webcamElement.style.transform="",this.selectCamera()} start(e=!0){return new Promise(function(t,s){this.stop(),navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then(function(i){this._streamList.push(i),this.info().then(function(i){this.selectCamera(),e?this.stream().then(function(e){t(this._facingMode)}).catch(function(e){s(e)}):t(this._selectedDeviceId)}).catch(function(e){s(e)})}).catch(function(e){s(e)})})} info(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(t){this.getVideoInputs(t),e(this._webcamList)}).catch(function(e){t(e)})})} stream(){return new Promise(function(e,t){navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then(function(t){this._streamList.push(t),this._webcamElement.srcObject=t,"user"==this._facingMode&&(this._webcamElement.style.transform="scale(-1,1)"),this._webcamElement.play(),e(this._facingMode)}).catch(function(e){console.log(e),t(e)})})}stop(){this._streamList.forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})}snap(){if(null!=this._canvasElement){null!=this._snapSoundElement&&this._snapSoundElement.play(),this._canvasElement.height=this._webcamElement.scrollHeight,this._canvasElement.width=this._webcamElement.scrollWidth;let e=this._canvasElement.getContext("2d");return"user"==this._facingMode&&(e.translate(this._canvasElement.width,0),e.scale(-1,1)),e.clearRect(0,0,this._canvasElement.width,this._canvasElement.height),e.drawImage(this._webcamElement,0,0,this._canvasElement.width,this._canvasElement.height),this._canvasElement.toDataURL("image/png")}throw"canvas element is missing"}}